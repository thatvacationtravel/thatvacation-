{% extends "index.html" %}
{% load static %}
{% load custom_filter_add_bookingpro %}


{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- intl-tel-input JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

    <style>
        #toggleIncluded {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            font-size: 16px;
            color: #616179;
        }

        .triangle-down {
            width: 0;
            height: 0;
            margin-left: 8px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #616179;
            transition: transform 0.3s;
        }

        .triangle-up {
            transform: rotate(180deg);
        }

        #toggleIncluded1 {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            font-size: 16px;
            color: #616179;
        }

        .triangle-down1 {
            width: 0;
            height: 0;
            margin-left: 8px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #616179;
            transition: transform 0.3s;
        }

        .triangle-up1 {
            transform: rotate(180deg);
        }

        #toggleIncluded2 {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            font-size: 16px;
            color: #616179;
        }

        .triangle-down2 {
            width: 0;
            height: 0;
            margin-left: 8px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #616179;
            transition: transform 0.3s;
        }

        .triangle-up2 {
            transform: rotate(180deg);
        }


        #toggleIncluded3 {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            font-size: 16px;
            color: #616179;
        }

        .triangle-down3 {
            width: 0;
            height: 0;
            margin-left: 8px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #616179;
            transition: transform 0.3s;
        }

        .triangle-up3 {
            transform: rotate(180deg);
        }


        #toggleIncluded4 {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            font-size: 16px;
            color: #616179;
        }

        .triangle-down4 {
            width: 0;
            height: 0;
            margin-left: 8px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #616179;
            transition: transform 0.3s;
        }

        .triangle-up4 {
            transform: rotate(180deg);
        }



        .checkbox-wrapper {
            display: flex;
            align-items: center;
        }

        .checkbox-input {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            transform: scale(2.5);
        }

        #agree-checkbox{
            width: 15px;
            height: 15px;
        }

        .checkbox-text {
            margin: 10;
            vertical-align: middle;
        }


input[type="text"], input[type="password"] {
    width: 100% !important;
    padding: 10px 15px !important;
    margin-bottom: 0.5rem !important;
    border: 1px solid #92afd1 !important;
    border-radius: 4px !important;
    box-sizing: border-box !important;
    font-size: 12px;
}



.form-select {
    display: block;
    width: 100%;
    padding: .375rem 2.25rem .375rem .75rem;
    font-size: .9rem;
    font-weight: 400;
    line-height: 1.7;
    color: #7c7f85;
    background-color: #fff;
    background-repeat: no-repeat;
    background-position: right .75rem center;
    background-size: 16px 12px;
    border: 1px solid #95b9dd;
    border-radius: 5px;
    appearance: none;
}


.form-control:disabled,
.form-control:read-only {
    background-color: #f7f7f700 !important;

    border: none !important;
    appearance: none !important;
    padding: 10px 15px !important;
    color: black !important;
    font-size: inherit !important;
    width: auto !important;
    display: inline-block !important;
    box-sizing: border-box !important;
    padding-top: 1px !important;
    padding-left: 1px !important;
}



 .error {
            background-color: #fc6a6a;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
        }
.success {
            background-color: #8adcdc;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: bold;
        }
 #message {
            display: none;
        }


    </style>

    <div class="container">
        <div id="message" class="{% if error %}error{% elif success %}success{% endif %}">
        {% if error %}
            <p>{{ error }} Please try again.</p>

        {% elif success %}
            {{ success }}
        {% endif %}
    </div>


        <div class="row">
            <div class="col-lg-6 order-1 order-md-2">
                <h4 class="mt-4 mb-4">Documentation and Immigration Requirements</h4>
                <div class="card">
                    <div class="card-body">
                        <image style="width: 30%; float: right;" src="{% static 'images/logos/logoMSC.png' %}" /><br>
                        <p style="font-size: 14px;">

                                <p style="font-size: 12px;">
                                    Guests are highly encouraged to travel with a valid passport, even when not required.
                                    For your protection, we recommend that your passport expiration date does not occur within six (6)
                                    months of the sailing return date.<br>
                                    Some foreign ports of call require a visa. Please contact the Embassy (Consular Services) of each country
                                    on your sailing itinerary or the visa service of your choice for specific visa requirements, information,
                                    forms and fees for your nationality. That Vacation Travel Corp. suggests the visa provider, CIBT at
                                    <a href="https://visacentral.com" target="_blank">www.visacentral.com</a>
                                    The spelling of the guest(s) name as booked for a cruise must match exactly as their valid passport or
                                    proof of citizenship / identification during ship check-in formalities.<br>
                                </p>
                                <p style="color: #0a0a0a;">• Age Restrictions:</p>
                                <p style="font-size: 12px;">
                                    This cruise line requires that passengers younger than 21 years old be accompanied by an adult 21 years
                                    or older in the same cabin. Infants must be at least 6 months old as of the first day of the cruise.<br>
                                </p>
                                <p style="color: #0a0a0a;">• Pregnancy Restrictions:</p>
                                <p style="font-size: 12px;">
                                Pregnant women are highly recommended to seek medical advice prior to travel at any stage of their
                                pregnancy. The Carrier cannot for safety reasons carry pregnant Passengers of 24 weeks or more by the
                                end of the cruise. The Carrier reserves the right to request a medical certificate at any stage of
                                pregnancy and to refuse passage if the Carrier and/or the Master are not satisfied that the Passenger
                                will be safe during the passage.
                                </p>
                                <a href="https://thatvacationtravel.com/media/politicas_privacidad/MSC_booking-terms_VZd35b6.pdf" target="_blank">Cancellation Policies</a><br>
                                <a href="https://thatvacationtravel.com/static/pdf/That%20Vacation%20Travel%20-terms-and-conditions-%20ST38963.pdf" target="_blank">Terms and Conditions</a>

                            </p>

                    </div>
                </div>
            </div>

            <!-- Columna izquierda para los formularios de pasajero, en móvil se muestra segundo -->
            <div class="col-lg-6 order-2 order-md-1">
                <h4 class="mt-4 mb-4">Payment Information</h4>
                <div class="card shadow-sm rounded">
                    <div class="card-body">
                        {% if booking_no %}
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="total" value="{{ total }}">
                            <div class="form-group">
                                <input type="hidden" id="credit_card_code" name="credit_card_code" required>
                            </div>
                            <div class="form-group row">
                                <div class="col">
                                    <select class="form-select" id="Country" name="country" required>
                                        <option value="" disabled selected>Select a country</option>
                                        <option value="US">United States</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="text" id="address" name="address" required placeholder="Billing Address:">
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col">
                                    <select class="form-select" id="State" name="state" required>
                                        <option value="" disabled selected>Select a state</option>
                                    </select>
                                </div>
                                <div class="col">

                                <input type="text" id="City" name="city" required placeholder="City:">
                                </div>
                            </div>
                            <div class="col">
                                <input type="text" id="Zipcode" name="zipcode" required placeholder="Zipcode:">
                            </div>
                            <div class="form-group row">
                                <div class="col">
                                    <img style="width: 28px; height:auto;" src="{% static 'img/mc.png'%}">
                                    <img style="width: 28px; height:auto;" src="{% static 'img/discover.png'%}">
                                    <img style="width: 28px; height:auto;" src="{% static 'img/visa.png' %}">
                                    <img style="width: 28px; height:auto;" src="{% static 'img/commercial.png'%}">
                                    <img style="width: 28px; height:auto;" src="{% static 'img/amex.png'%}">
                                </div>
                            </div>
                            <br>
                            <div class="form-group">
                                <input type="text" id="credit_card_number" name="credit_card_number" required placeholder="Credit Card Number:">
                            </div>
                            <div class="form-group">
                                <input type="text" id="name_on_credit_card" name="name_on_credit_card" required placeholder="Name on Credit Card:">
                            </div>

                            <div class="form-group row">
                                <div class="col">
                                    <input type="text" id="ccv_code" name="ccv_code" required placeholder="CCV Code">
                                </div>

                                <div class="col">
                                    <input type="text" id="expiration_month" name="expiration_month" required placeholder="Exp Month:">
                                </div>

                                <div class="col">
                                    <input type="text" id="expiration_year" name="expiration_year" required required placeholder="Exp Year:">
                                </div>
                            </div>
                            <hr />
                            <div class="form-group">
                                <center><h4>Select Payment Option</h4></center>

                                <!-- Pago total -->
                                <div style="font-size:12px;" class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_option" id="total_payment" value="{{ booking.balance }}" onchange="updatePaymentAmount()" checked>
                                    <label class="form-check-label" for="total_payment">
                                        Pay Total: ${{ booking.balance }}
                                    </label>
                                </div>

                                <!-- Pago personalizado -->
                                <div style="font-size:12px;" class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_option" id="deposit_payment" value="custom" onchange="updatePaymentAmount()">
                                    <label class="form-check-label" for="deposit_payment">
                                        Custom Pay:
                                    </label>
                                    <input type="number" class="form-control" id="deposit_amount_input" style="display:inline-block; width: 100px;" min="0" placeholder="Enter amount" oninput="updatePaymentAmount()" disabled>
                                </div>

                                <!-- Campo oculto para el monto a pagar -->
                                <input type="hidden" id="payment_amount_hidden" name="payment_amount" value="{{ booking.balance }}">

                                <div style="font-size:14px;" class="form-group-input">
                                    Amount to Pay: $<input type="text" id="payment_amount_display" class="form-control" value="{{ booking.balance }}" readonly>
                                </div>
                            </div>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="agree-checkbox" name="terms">
                                <p style="font-size: 10px;" class="checkbox-text">
                                    By clicking on the button below, I acknowledge that I have reviewed the <a href="https://thatvacationtravel.com/media/politicas_privacidad/MSC_booking-terms_VZd35b6.pdf" target="_blank">
                                        Privacy Statement and cancellations.</a>
                                    and<a target="_blank" href="https://travel.state.gov/content/travel/en/traveladvisories/traveladvisories.html"> Government Travel Advice Opens in a new window.</a>
                                    and have reviewed and accept the Rules & Restrictions Opens in a new window. and<a href="https://thatvacationtravel.com/static/pdf/That%20Vacation%20Travel%20-terms-and-conditions-%20ST38963.pdf" target="_blank"> Terms of Use Opens in a new window..</a>
                                </p>
                            </div>

                            <div class="form-group">
                                <input id="submit-btn" class="btn btn-primary" type="submit" value="Make Payment" disabled>
                            </div>
                            <br>
                            <div>
                                <p style="font-size: 12px;">
                                    We use secure transmission and encrypted storage to protect your personal information.
                                    Payments are processed in the U.S. except where the travel provider (hotel / airline etc.) processes your
                                    payment outside the U.S., in which case your card issuer may charge a foreign transaction fee.
                                </p>
                            </div>
                        </form>
                        {% endif %}
                        <div class="container">
                            <p style="font-size: 12px;">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>






 <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const errorMessage = getQueryParam('error');
        const successMessage = getQueryParam('success');

        const messageElement = document.getElementById('message');

        if (errorMessage) {
            messageElement.textContent = decodeURIComponent(errorMessage);

            if (errorMessage) {
                messageElement.textContent = decodeURIComponent(errorMessage) + ' Please try again';
            }

            messageElement.className = 'error';
            messageElement.style.display = 'block';
        } else if (successMessage) {
            messageElement.textContent = decodeURIComponent(successMessage);
            messageElement.className = 'success';
            messageElement.style.display = 'block';
        } else {
            messageElement.style.display = 'none';
        }
    </script>



    <script>
        document.getElementById('toggleIncluded').addEventListener('click', function() {
            var includedList = document.getElementById('includedList');
            var triangle = document.getElementById('triangle');

            if (includedList.style.display === 'none') {
                includedList.style.display = 'block';
                triangle.classList.add('triangle-up');
            } else {
                includedList.style.display = 'none';
                triangle.classList.remove('triangle-up');
            }
        });
    </script>

    <script>
        document.getElementById('toggleIncluded1').addEventListener('click', function() {
            var includedList1 = document.getElementById('includedList1');
            var triangle1 = document.getElementById('triangle1');

            if (includedList1) {
                if (includedList1.style.display === 'none') {
                    includedList1.style.display = 'block';
                    triangle1.classList.add('triangle-up1');
                } else {
                    includedList1.style.display = 'none';
                    triangle1.classList.remove('triangle-up1');
                }
            }
        });
    </script>


    <script>
        document.getElementById('toggleIncluded2').addEventListener('click', function() {
            var includedList1 = document.getElementById('includedList2');
            var triangle1 = document.getElementById('triangle2');

            if (includedList1) {
                if (includedList1.style.display === 'none') {
                    includedList1.style.display = 'block';
                    triangle1.classList.add('triangle-up2');
                } else {
                    includedList1.style.display = 'none';
                    triangle1.classList.remove('triangle-up2');
                }
            }
        });
    </script>


<script>
    document.getElementById('toggleIncluded4').addEventListener('click', function() {
        var includedList1 = document.getElementById('includedList4');
        var triangle1 = document.getElementById('triangle4');

        if (includedList1) {
            if (includedList1.style.display === 'none') {
                includedList1.style.display = 'block';
                triangle1.classList.add('triangle-up4');
            } else {
                includedList1.style.display = 'none';
                triangle1.classList.remove('triangle-up4');
            }
        }
    });
</script>


<script>
    document.getElementById('toggleIncluded3').addEventListener('click', function() {
        var includedList1 = document.getElementById('includedList3');
        var triangle1 = document.getElementById('triangle3');

        if (includedList1) {
            if (includedList1.style.display === 'none') {
                includedList1.style.display = 'block';
                triangle1.classList.add('triangle-up3');
            } else {
                includedList1.style.display = 'none';
                triangle1.classList.remove('triangle-up3');
            }
        }
    });
</script>

        {% for passenger_form in formset %}
        {% if not forloop.first %}
        <script>
            document.getElementById('togglePassenger{{ forloop.counter }}').addEventListener('click', function() {
                var fieldset = document.getElementById('passengerFieldset{{ forloop.counter }}');
                var triangle = document.getElementById('trianglePassenger{{ forloop.counter }}');

                if (fieldset.style.display === 'none') {
                    fieldset.style.display = 'block';
                    triangle.classList.add('triangle-up');
                } else {
                    fieldset.style.display = 'none';
                    triangle.classList.remove('triangle-up');
                }
            });
        </script>
        {% endif %}
    {% endfor %}



    <script>
        function updatePaymentAmount() {
            var paymentOption = document.querySelector('input[name="payment_option"]:checked');
            var paymentAmountHidden = document.getElementById("payment_amount_hidden");
            var paymentAmountDisplay = document.getElementById("payment_amount_display");
            var depositInput = document.getElementById("deposit_amount_input");

            if (paymentOption.id === 'deposit_payment') {
                depositInput.disabled = false;
                paymentAmountHidden.value = depositInput.value || 0;
            } else {
                depositInput.disabled = true;
                paymentAmountHidden.value = paymentOption.value;
            }

            paymentAmountDisplay.value = paymentAmountHidden.value;
        }

        window.onload = function() {
            var depositInput = document.getElementById("deposit_amount_input");
            var depositPaymentRadio = document.getElementById("deposit_payment");

            if (!depositPaymentRadio.checked) {
                depositInput.disabled = true;
            }
        }
    </script>



<script>
    document.addEventListener('DOMContentLoaded', function() {
        const creditCardNumberInput = document.getElementById('credit_card_number');
        const creditCardCodeInput = document.getElementById('credit_card_code');

        creditCardNumberInput.addEventListener('input', function() {
            const cardNumber = creditCardNumberInput.value;
            const firstDigit = cardNumber.charAt(0);
            const firstTwoDigits = cardNumber.substring(0, 2);
            const firstFourDigits = cardNumber.substring(0, 4);

            if (firstTwoDigits === '34' || firstTwoDigits === '37') {
                creditCardCodeInput.value = 'AX'; // American Express
            } else if (firstTwoDigits === '41' || firstTwoDigits === '40' || firstTwoDigits === '42' || firstTwoDigits === '44')  {
                creditCardCodeInput.value = 'VI'; // Visa
            } else if (firstTwoDigits === '54' || firstTwoDigits === '51' || firstTwoDigits === '52' || firstTwoDigits === '55') {
                creditCardCodeInput.value = 'MC'; // MasterCard
            } else if (firstFourDigits === '6011') {
                creditCardCodeInput.value = 'DS'; // Discover
            } else if (firstTwoDigits === '36') {
                creditCardCodeInput.value = 'DC'; // Dinners Club
            } else {
                creditCardCodeInput.value = '';
            }
        });
    });
    </script>





<script>
    document.addEventListener('DOMContentLoaded', function() {
    const termsCheckbox = document.getElementById('agree-checkbox');
    const submitButton = document.getElementById('submit-btn');
    submitButton.disabled = true;

    termsCheckbox.addEventListener('change', function() {
        if (termsCheckbox.checked) {
            submitButton.disabled = false;
        } else {
            submitButton.disabled = true;
        }
    });
});
    </script>


<script>
    document.getElementById('Country').addEventListener('change', function() {
        var country = this.value;
        if (country === 'US') {
            var stateSelect = document.getElementById('State');
            stateSelect.innerHTML = '';

            fetch('/get_states/')
                .then(response => response.json())
                .then(states => {
                    states.forEach(state => {
                        var option = document.createElement('option');
                        option.value = state.code;
                        option.textContent = state.name;
                        stateSelect.appendChild(option);
                    });
                });
        }
    });

    document.getElementById('State').addEventListener('change', function() {
        var selectedOption = this.options[this.selectedIndex].text;
        var stateParts = selectedOption.split(',');
        if (stateParts.length > 0) {
            var stateName = stateParts[stateParts.length - 1].trim();
            loadCities(stateName);
        } else {
            console.error('Formato inesperado para el estado:', selectedOption);
        }
    });

</script>

{% endblock %}